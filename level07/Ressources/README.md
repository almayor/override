## Level07

На данном уровне нам дан массив из 100 ячеек, в который мы можем записывать произвольные значения. Каждая ячейка имеет размер в 4 байта (стандартный `int`). Мы сразу замечаем уязвимость: индексы, переданные в команду `store`, никак не проверяются, а значит, мы можем писать в произовальные места на стеке. Наш план таков: (1) записать [шелл-код](https://shell-storm.org/shellcode/files/shellcode-863.php) для запуска командной оболочки в массив, (2) перезаписать сохраненный на стеке регистр `eip`, чтобы по окончанию функции `main` контроль переходил к шелл-коду.

Существует сложность, связанная с тем, что программа не позволяет напрямую использовать ячейки массива, расположенные под индексами, кратными 3. Однако данную защиту легко обойти, прибавляя к таким индексам `0b01000000000000000000000000000000 = 1073741824`:
* После умножения на 4 (что равносильно операции `idx <<= 2`) данный "префикс" не будет играть роли
* Если `idx % 3 = 0`, то
```
(idx + 1073741824) % 3 = (idx % 3) + (1073741824 % 3) = 0 + 1 = 1 != 0`
```

Расстояние между началом массива и местоположением сохраненного `eip` можно вычислить с помощью `gdb` -- оно равно 456 байтам, что соотвествует индексу `idx = 114`. Однако абсолютный адрес начала массива может разниться между запусками программы изнутри `gdb`, в том числе из-за разных переменных окружения. Чтобы учесть эти различия, мы добавляем NOP-slide в 50 байтов перед началом шелл-кода.

Вся процедура получения эксплойта расписана в ноутбуке `Ressources/generating_input.ipynb`. Получившийся файл `input.txt` мы копируем на машину и передаем его программе.

```sh
$ cat input.txt - | ./level07
...
whoami
level08
cd ../level08
cat .pass
7WJ6jFBzrcjEYXudxnM3kdW7n3qyxR6tk2xGrkSC
```

Наконец заметим, что, помимо отсуствия проверки индексов, наш экплойт работает благодаря тому, что программа была скомпилирована с `NX disabled`. 
